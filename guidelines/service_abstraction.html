
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Service Abstraction &#8212; PyAnsys Developers Guide 0.2.dev0 documentation</title>
    
  <link href="../_static/css/theme.css" rel="stylesheet">
  <link href="../_static/css/index.ff1ffe594081f20da1ef19478df9384b.css" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      

    
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/css/blank.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    
  <link rel="preload" as="script" href="../_static/js/index.be7d3bbb2ef33a8344ce.js">

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="PyAnsys Libraries on a Windows Subsystem for Linux and Docker" href="PyMAPDL_WSL_Guide.html" />
    <link rel="prev" title="Logging Guidelines" href="logging.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <div class="container-fluid" id="banner"></div>

    
    <nav class="navbar navbar-light navbar-expand-lg bg-light fixed-top bd-navbar" id="navbar-main"><style>
    .navbar-light {
        background-color: black !important;
    }
</style>

<div class="container-xl">

  <div id="navbar-start">
    
    

<a class="navbar-brand" href="https://docs.pyansys.com/">
  <img src="../_static/pyansys-logo-black-cropped.png" class="logo" alt="logo">
</a>


    
  </div>

  <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-collapsible" aria-controls="navbar-collapsible" aria-expanded="false" aria-label="Toggle navigation">
    <span class="navbar-toggler-icon" >
      <i class="fas fa-bars" style="color:#fff; font-size:28px;"></i>
    </span>
  </button>

  
  <div id="navbar-collapsible" class="col-lg-9 collapse navbar-collapse">
    <div id="navbar-center" class="mr-auto">
      
      <div class="navbar-center-item">
        <ul id="navbar-main-elements" class="navbar-nav">
    <li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../overview/index.html">
  Overview
 </a>
</li>

<li class="toctree-l1 current active nav-item">
 <a class="reference internal nav-link" href="index.html">
  Guidelines and Best Practices
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../library_description/index.html">
  Library Overview
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../coding_style/index.html">
  Coding Style
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../documentation_style/index.html">
  API Documentation Style
 </a>
</li>

    
</ul>
      </div>
      
    </div>

    <div id="navbar-end">
      
      <div class="navbar-end-item">
        <ul id="navbar-icon-links" class="navbar-nav" aria-label="Icon Links">
        <li class="nav-item">
          <a class="nav-link" href="https://github.com/pyansys/about" rel="noopener" target="_blank" title="GitHub">
            <span><i class="fab fa-github-square"></i></span>
            <label class="sr-only">GitHub</label>
          </a>
        </li>
      </ul>
      </div>
      
    </div>
  </div>
</div>
    </nav>
    

    <div class="container-xl">
      <div class="row">
          
            
            <!-- Only show if we have sidebars configured, else just a small margin  -->
            <div class="col-12 col-md-3 bd-sidebar"><form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search the docs ..." aria-label="Search the docs ..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">
  <div class="bd-toc-item active">
    <ul class="current nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="dev_practices.html">
   Development Practices
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="version_support.html">
   Python Version Support
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="doc_practices.html">
   Documentation Practices
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="app_interface_abstraction.html">
   Application Interface Abstraction
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="data_transfer_and_representation.html">
   Data Transfer and Abstraction
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="logging.html">
   Logging Guidelines
  </a>
 </li>
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   Service Abstraction
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="PyMAPDL_WSL_Guide.html">
   PyAnsys Libraries on a Windows Subsystem for Linux and Docker
  </a>
 </li>
</ul>

  </div>
</nav>
            </div>
            
          

          
          <div class="d-none d-xl-block col-xl-2 bd-toc">
            
              
              <div class="toc-item">
                

<nav id="bd-toc-nav">
    
</nav>
              </div>
              
              <div class="toc-item">
                
              </div>
              
            
          </div>
          

          
          
            
          
          <main class="col-12 col-md-9 col-xl-7 py-md-5 pl-md-5 pr-md-4 bd-content" role="main">
              
              <div>
                
  <div class="section" id="service-abstraction">
<h1>Service Abstraction<a class="headerlink" href="#service-abstraction" title="Permalink to this headline">¶</a></h1>
<p>Some Ansys products are exposed as services that permit remote
execution using technologies like <a class="reference external" href="https://en.wikipedia.org/wiki/Representational_state_transfer">REST</a> or <a class="reference external" href="https://grpc.io/">gRPC</a>.  These services
are typically exposed in a manner where the API has already been
abstracted because not all methods can be exposed through a remote API.
Here, the abstraction of the service is as crucial as in the case of
the “desktop API”. In this case, remote API calls should be identical
if the service is local or remote, with the only difference being that local
calls are faster to execute.</p>
<p>Consider the following code examples. The left-hand side shows the
amount of work to start, establish a connection to, and submit an
input file to MAPDL using auto-generated gRPC interface files. For
more information, see <a class="reference external" href="https://github.com/pyansys/pyansys-protos-generator">pyansys-protos-generator</a>.  The
right-hand side shows the same workflow but uses the <a class="reference external" href="https://github.com/pyansys/pymapdl">PyMAPDL</a> library.</p>
<table class="table">
<colgroup>
<col style="width: 57%" />
<col style="width: 43%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Using the gRPC Auto-generated Interface</p></th>
<th class="head"><p>Using the <a class="reference external" href="https://github.com/pyansys/pymapdl">PyMAPDL</a> Library</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">grpc</span>

<span class="kn">from</span> <span class="nn">ansys.mapdl</span> <span class="kn">import</span> <span class="n">mapdl_pb2</span> <span class="k">as</span> <span class="n">pb_types</span>
<span class="kn">from</span> <span class="nn">ansys.mapdl</span> <span class="kn">import</span> <span class="n">mapdl_pb2_grpc</span> <span class="k">as</span> <span class="n">mapdl_grpc</span>
<span class="kn">from</span> <span class="nn">ansys.mapdl</span> <span class="kn">import</span> <span class="n">kernel_pb2</span> <span class="k">as</span> <span class="n">anskernel</span>
<span class="kn">from</span> <span class="nn">ansys.client.launcher.client</span> <span class="kn">import</span> <span class="n">Launcher</span>

<span class="c1"># start MAPDL</span>
<span class="n">sm</span> <span class="o">=</span> <span class="n">Launcher</span><span class="p">()</span>
<span class="n">job</span> <span class="o">=</span> <span class="n">sm</span><span class="o">.</span><span class="n">create_job_by_name</span><span class="p">(</span><span class="s2">&quot;mapdl-212&quot;</span><span class="p">)</span>
<span class="n">service_name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;grpc-</span><span class="si">{</span><span class="n">job</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span>
<span class="n">mapdl_service</span> <span class="o">=</span> <span class="n">sm</span><span class="o">.</span><span class="n">get_service</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">service_name</span><span class="p">)</span>

<span class="c1"># create a gRPC channel</span>
<span class="n">channel_str</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">:</span><span class="si">%d</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">mapdl_service</span><span class="o">.</span><span class="n">host</span><span class="p">,</span>
                         <span class="n">mapdl_service</span><span class="o">.</span><span class="n">port</span><span class="p">)</span>
<span class="n">channel</span> <span class="o">=</span> <span class="n">grpc</span><span class="o">.</span><span class="n">insecure_channel</span><span class="p">(</span><span class="n">channel_str</span><span class="p">)</span>
<span class="n">stub</span> <span class="o">=</span> <span class="n">mapdl_grpc</span><span class="o">.</span><span class="n">MapdlServiceStub</span><span class="p">(</span><span class="n">channel</span><span class="p">)</span>

<span class="c1"># send an input file request</span>
<span class="n">request</span> <span class="o">=</span> <span class="n">pb_types</span><span class="o">.</span><span class="n">InputRequest</span><span class="p">(</span><span class="n">filename</span><span class="o">=</span><span class="s1">&#39;ds.dat&#39;</span><span class="p">)</span>
<span class="n">response</span> <span class="o">=</span> <span class="n">stub</span><span class="o">.</span><span class="n">InputFileS</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
<span class="c1"># additional postprocessing to parse response</span>
</pre></div>
</div>
</td>
<td><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">ansys.mapdl</span> <span class="kn">import</span> <span class="n">core</span> <span class="k">as</span> <span class="n">pymapdl</span>

<span class="c1"># start mapdl and read the input file</span>
<span class="n">mapdl</span> <span class="o">=</span> <span class="n">pymapdl</span><span class="o">.</span><span class="n">launch_mapdl</span><span class="p">()</span>
<span class="n">output</span> <span class="o">=</span> <span class="n">mapdl</span><span class="o">.</span><span class="n">input</span><span class="p">(</span><span class="s1">&#39;ds.dat&#39;</span><span class="p">)</span>
</pre></div>
</div>
</td>
</tr>
</tbody>
</table>
<p>The approach on the right has a number of advantages, including:</p>
<ul class="simple">
<li><p>Readability due to the abstraction of the service startup</p></li>
<li><p>Short package names</p></li>
<li><p>Simplified interface for starting MAPDL</p></li>
<li><p>Full documentation strings for all classes, methods, and functions</p></li>
</ul>
<p>To properly abstract a service, users must have the option to
either launch the service and connect to it locally if the software exists on
their machines or connect to a remote instance of the service.  One
way to do this is to include a function to launch the service.</p>
<p>This example includes <code class="docutils literal notranslate"><span class="pre">launch_mapdl</span></code>, which brokers a connection via the
<code class="docutils literal notranslate"><span class="pre">Mapdl</span></code> class:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">ansys.mapdl.core</span> <span class="kn">import</span> <span class="n">Mapdl</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">mapdl</span> <span class="o">=</span> <span class="n">Mapdl</span><span class="p">(</span><span class="n">ip</span><span class="o">=&lt;</span><span class="n">IP</span> <span class="n">Address</span><span class="o">&gt;</span><span class="p">,</span> <span class="n">port</span><span class="o">=&lt;</span><span class="n">Port</span><span class="o">&gt;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">mapdl</span><span class="p">)</span>
<span class="go">Product:             Ansys Mechanical Enterprise</span>
<span class="go">MAPDL Version:       21.2</span>
<span class="go">ansys.mapdl Version: 0.59.dev0</span>
</pre></div>
</div>
<p>This straightforward approach connects to a local or remote instance
of MAPDL via gRPC by instantiating an instance of the <code class="docutils literal notranslate"><span class="pre">Mapdl</span></code> class.
At this point, because the assumption is that MAPDL is always remote, it’s
possible to issue commands to MAPDL, including those requiring
file transfer like <code class="docutils literal notranslate"><span class="pre">Mapdl.input</span></code>.</p>
</div>


              </div>
              
              
          </main>
          

      </div>
    </div>
  
  <script src="../_static/js/index.be7d3bbb2ef33a8344ce.js"></script>
<footer class="footer mt-5 mt-md-0">
  <div class="container">
    
    <div class="footer-item">
      <p class="copyright">
    &copy; Copyright (c) 2022 ANSYS, Inc. All rights reserved.<br>
</p>
    </div>
    
    <div class="footer-item">
      <p class="sphinx-version">
Created using <a href="http://sphinx-doc.org/">Sphinx</a> 4.3.2.<br>
</p>
    </div>
    
  </div>
</footer>
  </body>
</html>